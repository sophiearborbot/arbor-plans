<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Arbor Family Plans ‚Äî Sophie's Hub</title>
<style>
  * { box-sizing: border-box; margin: 0; padding: 0; }
  body { font-family: 'Segoe UI', system-ui, sans-serif; background: #0f1117; color: #e8eaf0; min-height: 100vh; }

  header {
    background: linear-gradient(135deg, #1a1f2e, #2a1f3a);
    padding: 28px 32px 20px;
    border-bottom: 1px solid #2e3a50;
  }
  .header-top { display: flex; align-items: center; justify-content: space-between; flex-wrap: wrap; gap: 12px; }
  header h1 { font-size: 1.6rem; font-weight: 800; color: #e8eaf0; }
  header p { color: #7a8a9a; margin-top: 4px; font-size: 0.85rem; }
  .sophie-tag {
    background: rgba(156,39,176,0.15); border: 1px solid rgba(156,39,176,0.3);
    color: #ce93d8; padding: 5px 14px; border-radius: 20px; font-size: 0.75rem; white-space: nowrap;
  }

  /* FILTER BAR */
  .filter-bar {
    display: flex; align-items: center; gap: 8px; flex-wrap: wrap;
    padding: 14px 32px; background: #13151f; border-bottom: 1px solid #1e2433;
    position: sticky; top: 0; z-index: 100;
  }
  .filter-label { font-size: 0.72rem; color: #546e7a; font-weight: 600; text-transform: uppercase; letter-spacing: 1px; margin-right: 4px; }
  .filter-btn {
    padding: 5px 13px; border-radius: 20px; font-size: 0.75rem; font-weight: 600;
    border: 1px solid transparent; cursor: pointer; transition: all 0.15s;
    background: rgba(255,255,255,0.05); color: #7a8a9a; border-color: #2e3a50;
  }
  .filter-btn:hover { color: #e8eaf0; border-color: #4a5a6a; }
  .filter-btn.active { color: #fff; }
  .filter-btn[data-filter="all"].active { background: rgba(255,255,255,0.12); border-color: #546e7a; color: #e8eaf0; }
  .filter-btn[data-filter="sage"].active { background: rgba(76,175,80,0.2); border-color: #4caf50; color: #81c784; }
  .filter-btn[data-filter="tafline"].active { background: rgba(244,67,54,0.2); border-color: #f44336; color: #ef9a9a; }
  .filter-btn[data-filter="asher"].active { background: rgba(255,193,7,0.2); border-color: #ffc107; color: #ffd54f; }
  .filter-btn[data-filter="verity"].active { background: rgba(233,30,99,0.2); border-color: #e91e63; color: #f48fb1; }
  .filter-btn[data-filter="family"].active { background: rgba(0,188,212,0.2); border-color: #00bcd4; color: #80deea; }

  /* TIMELINE */
  .timeline-section { padding: 28px 32px; max-width: 1100px; margin: 0 auto; }
  .section-header {
    display: flex; align-items: center; gap: 10px;
    font-size: 0.72rem; font-weight: 700; text-transform: uppercase; letter-spacing: 1.5px;
    color: #546e7a; margin-bottom: 16px; padding-bottom: 8px; border-bottom: 1px solid #1e2433;
  }
  .section-header span { flex: 1; }
  .section-count { background: #1e2433; color: #546e7a; padding: 2px 8px; border-radius: 10px; font-size: 0.7rem; }

  /* CARDS */
  .cards { display: grid; grid-template-columns: repeat(auto-fill, minmax(310px, 1fr)); gap: 16px; }

  .plan-card {
    background: #1a1f2e; border: 1px solid #2e3a50; border-radius: 14px;
    overflow: hidden; text-decoration: none; color: inherit;
    transition: transform 0.15s, border-color 0.2s, box-shadow 0.2s;
    display: flex; flex-direction: column; position: relative;
  }
  .plan-card[data-href] { cursor: pointer; }
  .plan-card[data-href]:hover {
    transform: translateY(-3px);
    box-shadow: 0 8px 32px rgba(0,0,0,0.4);
  }
  .plan-card.hidden { display: none !important; }
  .plan-card { animation: fadeUp 0.25s ease both; }
  @keyframes fadeUp { from { opacity:0; transform:translateY(8px); } to { opacity:1; transform:translateY(0); } }

  .card-accent { height: 4px; width: 100%; }
  .card-inner { padding: 18px 20px; flex: 1; display: flex; flex-direction: column; }

  .card-top { display: flex; align-items: flex-start; justify-content: space-between; gap: 8px; margin-bottom: 10px; }
  .card-emoji { font-size: 2rem; line-height: 1; }
  .card-status {
    font-size: 0.65rem; font-weight: 700; text-transform: uppercase; letter-spacing: 0.8px;
    padding: 3px 9px; border-radius: 10px; white-space: nowrap;
  }
  .status-planning { background: rgba(255,193,7,0.15); color: #ffd54f; border: 1px solid rgba(255,193,7,0.3); }
  .status-confirmed { background: rgba(76,175,80,0.15); color: #81c784; border: 1px solid rgba(76,175,80,0.3); }
  .status-completed { background: rgba(255,255,255,0.07); color: #546e7a; border: 1px solid #2e3a50; }

  .card-category { font-size: 0.68rem; color: #546e7a; text-transform: uppercase; letter-spacing: 1px; margin-bottom: 4px; }
  .card-title { font-size: 1.05rem; font-weight: 700; margin-bottom: 6px; line-height: 1.3; }
  .card-date { font-size: 0.8rem; color: #ce93d8; font-weight: 600; margin-bottom: 8px; }
  .card-desc { font-size: 0.78rem; color: #7a8a9a; line-height: 1.6; flex: 1; }

  .card-footer {
    padding: 10px 20px; border-top: 1px solid #1e2433;
    display: flex; justify-content: space-between; align-items: center;
  }
  .who-tags { display: flex; gap: 5px; flex-wrap: wrap; }
  .who-tag {
    font-size: 0.65rem; font-weight: 700; padding: 2px 8px; border-radius: 10px;
  }
  .who-sage    { background: rgba(76,175,80,0.15);  color: #81c784; }
  .who-tafline { background: rgba(244,67,54,0.15);  color: #ef9a9a; }
  .who-asher   { background: rgba(255,193,7,0.15);  color: #ffd54f; }
  .who-verity  { background: rgba(233,30,99,0.15);  color: #f48fb1; }
  .who-family  { background: rgba(0,188,212,0.15);  color: #80deea; }

  .card-link { font-size: 0.75rem; color: #546e7a; }
  .plan-card[data-href]:hover .card-link { color: #ce93d8; }

  /* ARCHIVE ACCORDION */
  .archive-toggle {
    display: flex; align-items: center; gap: 10px; cursor: pointer;
    padding: 12px 0; user-select: none;
  }
  .archive-toggle:hover .section-header { color: #7a8a9a; }
  .archive-chevron { transition: transform 0.25s; font-size: 0.8rem; color: #546e7a; }
  .archive-chevron.open { transform: rotate(90deg); }
  .archive-cards { display: none; }
  .archive-cards.open { display: grid; grid-template-columns: repeat(auto-fill, minmax(310px, 1fr)); gap: 16px; }

  /* Completed cards are slightly dimmed */
  .plan-card.completed { opacity: 0.65; }
  .plan-card.completed:hover { opacity: 1; }

  /* PRINT */
  .print-btn {
    background: rgba(255,255,255,0.05); border: 1px solid #2e3a50; color: #7a8a9a;
    padding: 5px 13px; border-radius: 8px; font-size: 0.73rem; cursor: pointer;
    transition: all 0.15s;
  }
  .print-btn:hover { border-color: #546e7a; color: #e8eaf0; }

  footer {
    text-align: center; padding: 28px; font-size: 0.72rem; color: #3a4a5a;
    border-top: 1px solid #1e2433; margin-top: 20px;
  }

  @media (max-width: 600px) {
    .timeline-section { padding: 20px 16px; }
    .filter-bar { padding: 10px 16px; }
    header { padding: 20px 16px; }
  }

  
  /* ‚îÄ‚îÄ YEAR RIBBON ‚îÄ‚îÄ */
  .year-ribbon {
    background: #13151f; border-bottom: 1px solid #1e2433;
    padding: 8px 32px 6px; position: relative; overflow: hidden;
  }
  .ribbon-track { position: relative; height: 48px; overflow: visible; }
  .ribbon-bars  { position: absolute; top: 0; left: 0; right: 0; height: 24px; }
  .ribbon-months { position: absolute; bottom: 0; left: 0; right: 0; height: 18px; display: flex; }
  .ribbon-bar {
    position: absolute; height: 20px; top: 2px;
    border-radius: 4px; padding: 0 5px;
    display: flex; align-items: center;
    font-size: 0.6rem; font-weight: 700; color: rgba(255,255,255,0.92);
    overflow: hidden; white-space: nowrap; cursor: pointer;
    transition: filter 0.15s, transform 0.12s;
    box-shadow: inset 0 1px 0 rgba(255,255,255,0.12);
  }
  .ribbon-bar:hover { filter: brightness(1.2); transform: scaleY(1.15); z-index: 5; }
  .ribbon-bar.past { opacity: 0.35; }
  .ribbon-month {
    display: flex; align-items: center; justify-content: center;
    font-size: 0.58rem; font-weight: 600; color: #2e3a50;
    border-left: 1px solid #1e2433; flex-shrink: 0; overflow: hidden;
  }
  .ribbon-month:first-child { border-left: none; }
  .ribbon-month.is-current { color: #546e7a; font-weight: 800; }
  .ribbon-today {
    position: absolute; top: 0; bottom: 0; width: 1px;
    background: rgba(255, 80, 80, 0.55); z-index: 10; pointer-events: none;
  }
  .ribbon-today::before {
    content: "\25BC"; position: absolute; top: -1px; left: -4px;
    font-size: 7px; color: rgba(255, 80, 80, 0.7); line-height: 1;
  }
  .ribbon-tip {
    position: absolute; background: #1a1f2e; border: 1px solid #2e3a50;
    border-radius: 8px; padding: 7px 12px; font-size: 0.72rem; color: #e8eaf0;
    pointer-events: none; z-index: 999; display: none; white-space: nowrap;
    box-shadow: 0 4px 16px rgba(0,0,0,0.5);
  }
  .ribbon-tip strong { color: #ce93d8; }
  @media (max-width: 600px) {
    .year-ribbon { padding: 6px 16px 4px; }
    .ribbon-bar { height: 26px; top: 1px; font-size: 0.62rem; }
    .ribbon-track { height: 52px; }
    .ribbon-bars { height: 30px; }
    .ribbon-months { height: 18px; }
  }
  @media print { .year-ribbon { display: none; } }

  @media print {
    .filter-bar, .print-btn, .archive-toggle .archive-chevron { display: none; }
    .archive-cards { display: grid !important; }
    .plan-card.completed { opacity: 1; }
    body { background: white; color: black; }
    .plan-card { border: 1px solid #ccc; break-inside: avoid; }
  }
</style>
</head>
<body>

<header>
  <div class="header-top">
    <div>
      <h1>üó∫Ô∏è Arbor Family Plans</h1>
      <p>Trips, adventures, and things worth planning</p>
    </div>
    <div style="display:flex;gap:10px;align-items:center;">
      <button class="print-btn" onclick="location.href='./scrapbook.html'">üìñ Scrapbook Builder</button>
      <div class="sophie-tag">üé≠ Maintained by Sophie</div>
    </div>
  </div>
</header>

<div id="sophie-notes" style="background:rgba(156,39,176,0.07);border-bottom:1px solid rgba(156,39,176,0.15);padding:9px 32px;display:flex;align-items:center;gap:10px;flex-wrap:wrap;">
  <span style="font-size:0.72rem;color:#ce93d8;font-weight:700;">üé≠ Sophie:</span>
  <div style="display:flex;gap:16px;flex-wrap:wrap;" id="sophie-notes-items">
    <span style="font-size:0.73rem;color:#9c7ab0;">üèïÔ∏è Linville Gorge trail status ‚Äî <strong style="color:#ffd54f;">call (828) 652-2144</strong> before booking. West rim still closed from Helene.</span>
    <span style="font-size:0.73rem;color:#9c7ab0;">‚úàÔ∏è Japan fare alert active ‚Äî targeting &lt;$900/person. Check üìà Prices tab for trend.</span>
    <span style="font-size:0.73rem;color:#9c7ab0;">üèõÔ∏è Asher's DC trip Mar 4‚Äì6 added to calendar. Carpool 5:45 AM Wed.</span>
  </div>
  <button onclick="document.getElementById('sophie-notes').style.display='none'" style="margin-left:auto;background:none;border:none;color:#546e7a;cursor:pointer;font-size:1rem;line-height:1;">‚úï</button>
</div>

<div class="filter-bar">
  <span class="filter-label">Show:</span>
  <button class="filter-btn active" data-filter="all" onclick="setFilter('all')">All</button>
  <button class="filter-btn" data-filter="family" onclick="setFilter('family')">ü©µ Family</button>
  <button class="filter-btn" data-filter="sage" onclick="setFilter('sage')">üü¢ Sage</button>
  <button class="filter-btn" data-filter="tafline" onclick="setFilter('tafline')">üî¥ Tafline</button>
  <button class="filter-btn" data-filter="asher" onclick="setFilter('asher')">üü° Asher</button>
  <button class="filter-btn" data-filter="verity" onclick="setFilter('verity')">ü©∑ Verity</button>
</div>


<div class="year-ribbon" id="year-ribbon">
  <div class="ribbon-track" id="ribbon-track">
    <div class="ribbon-bars" id="ribbon-bars"></div>
    <div class="ribbon-months" id="ribbon-months"></div>
    <div class="ribbon-today" id="ribbon-today"></div>
  </div>
</div>
<div class="ribbon-tip" id="ribbon-tip"></div>

<div class="timeline-section">

  <!-- UPCOMING -->
  <div class="section-header">
    <span>üìÖ Upcoming</span>
    <span class="section-count" id="upcoming-count"></span>
  </div>

  <div class="cards" id="upcoming-cards">

    <!-- Spring Break Backpacking -->
    <div class="plan-card" data-href="./spring_break_camping.html" data-who="family asher verity sage tafline"
         onclick="location.href='./spring_break_camping.html'">
      <div class="card-accent" style="background: linear-gradient(90deg, #4caf50, #2d5016);"></div>
      <div class="card-inner">
        <div class="card-top">
          <div class="card-emoji">üèïÔ∏è</div>
          <div class="card-status status-planning">Planning</div>
        </div>
        <div class="card-category">Family ¬∑ Backpacking</div>
        <div class="card-title">Spring Break Backpacking</div>
        <div class="card-date">üìÖ Apr 9‚Äì12, 2026</div>
        <div class="card-desc">3-night dark-sky loop. #1 pick: Linville Gorge (best skies East Coast) ‚Äî verify Helene trail conditions first. 4 ranked backup options.</div>
      </div>
      <div class="card-footer">
        <div class="who-tags">
          <span class="who-tag who-family">Family</span>
        </div>
        <span class="card-link">View plan ‚Üí</span>
      </div>
    </div>

    <!-- Japan Couples Trip -->
    <div class="plan-card" data-href="./japan_may_2026.html" data-who="sage tafline"
         onclick="location.href='./japan_may_2026.html'">
      <div class="card-accent" style="background: linear-gradient(90deg, #9c27b0, #673ab7);"></div>
      <div class="card-inner">
        <div class="card-top">
          <div class="card-emoji">üáØüáµ</div>
          <div class="card-status status-planning">Planning</div>
        </div>
        <div class="card-category">Couples ¬∑ International</div>
        <div class="card-title">Japan ‚Äî Sage &amp; Tafline</div>
        <div class="card-date">üìÖ May 9‚Äì16, 2026</div>
        <div class="card-desc">Tokyo ‚Üí Hakone ‚Üí Kyoto. $4,500‚Äì$7,000 for two. Price tracker active ‚Äî alert set at $900/person. teamLab, ryokan, kaiseki, Fushimi Inari at dawn.</div>
      </div>
      <div class="card-footer">
        <div class="who-tags">
          <span class="who-tag who-sage">Sage</span>
          <span class="who-tag who-tafline">Tafline</span>
        </div>
        <span class="card-link">View plan ‚Üí</span>
      </div>
    </div>

    <!-- Europe 2026 -->
    <div class="plan-card" data-href="https://sophiearborbot.github.io/europe-2026/" data-who="family sage tafline asher verity"
         onclick="location.href='https://sophiearborbot.github.io/europe-2026/'">
      <div class="card-accent" style="background: linear-gradient(90deg, #e74c3c, #c0392b);"></div>
      <div class="card-inner">
        <div class="card-top">
          <div class="card-emoji">üåç</div>
          <div style="display:flex;flex-direction:column;gap:4px;align-items:flex-end;">
            <div class="card-status status-confirmed">‚úàÔ∏è Flights Confirmed</div>
            <div class="card-status status-planning">üó∫Ô∏è Route: Planning</div>
          </div>
        </div>
        <div class="card-category">Family ¬∑ International</div>
        <div class="card-title">Europe 2026</div>
        <div class="card-date">üìÖ Jun 12‚Äì28, 2026 ¬∑ Conf. LXTIOD</div>
        <div class="card-desc">AMS ‚Üí Belgium ‚Üí Paris (Jun 12‚Äì19 with family). Jun 20‚Äì27 family route ‚Äî choose one:<br>
          <span style="display:block;margin-top:5px;font-size:0.75rem;line-height:1.8;">
            üî¥ 1. Alpine Arc &nbsp; üîµ 2. Rhine Valley<br>
            üü£ 3. Alps &amp; Prague &nbsp; üü° 4. Iberian Arc &amp; Morocco
          </span>
        </div>
      </div>
      <div class="card-footer">
        <div class="who-tags">
          <span class="who-tag who-family">Family</span>
        </div>
        <span class="card-link">View map ‚Üó</span>
      </div>
    </div>

  </div>

  <!-- ARCHIVE ACCORDION -->
  <div style="margin-top: 36px;">
    <div class="archive-toggle" onclick="toggleArchive()">
      <div class="section-header" style="flex:1;margin-bottom:0;border-bottom:none;padding-bottom:0;">
        <span>üì¶ Past Adventures</span>
        <span class="section-count" id="archive-count">0</span>
      </div>
      <span class="archive-chevron" id="archive-chevron">‚ñ∂</span>
    </div>
    <div class="archive-cards" id="archive-cards" style="margin-top:16px;">
      <!-- Past events will appear here as trips are completed -->
      <div style="grid-column:1/-1;padding:24px;text-align:center;color:#3a4a5a;font-size:0.82rem;background:#13151f;border-radius:10px;border:1px dashed #2e3a50;">
        Nothing here yet ‚Äî completed trips will be archived for the scrapbook üì∏
      </div>
    </div>
  </div>

</div>

<footer>
  Updated by Sophie üé≠ ¬∑ <a href="https://github.com/sophiearborbot/arbor-plans" style="color:#3a5a7a;">github.com/sophiearborbot/arbor-plans</a>
</footer>

<script>
// Filter logic
function setFilter(f) {
  document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
  document.querySelector(`[data-filter="${f}"]`).classList.add('active');

  document.querySelectorAll('.plan-card').forEach(card => {
    const who = card.dataset.who || '';
    card.classList.toggle('hidden', f !== 'all' && !who.includes(f));
  });
  updateCounts();
}

function updateCounts() {
  const upcoming = document.querySelectorAll('#upcoming-cards .plan-card:not(.hidden)').length;
  document.getElementById('upcoming-count').textContent = upcoming;
}

// Archive accordion
function toggleArchive() {
  const cards = document.getElementById('archive-cards');
  const chevron = document.getElementById('archive-chevron');
  const open = cards.classList.toggle('open');
  chevron.classList.toggle('open', open);
  chevron.textContent = open ? '‚ñº' : '‚ñ∂';
}

// Countdown timers
const countdowns = {
  'Apr 9‚Äì12, 2026':   new Date('2026-04-09'),
  'May 9‚Äì16, 2026':   new Date('2026-05-09'),
  'Jun 12‚Äì28, 2026':  new Date('2026-06-12'),
};

document.querySelectorAll('.card-date').forEach(el => {
  const text = el.textContent;
  for (const [label, date] of Object.entries(countdowns)) {
    if (text.includes(label.replace('üìÖ ',''))) {
      const days = Math.ceil((date - new Date()) / 86400000);
      if (days > 0) {
        const chip = document.createElement('span');
        chip.style.cssText = 'margin-left:8px;font-size:0.65rem;background:rgba(255,255,255,0.07);color:#7a8a9a;padding:2px 7px;border-radius:8px;font-weight:600;';
        chip.textContent = `${days}d away`;
        if (days < 30) { chip.style.background = 'rgba(255,193,7,0.15)'; chip.style.color = '#ffd54f'; }
        if (days < 14) { chip.style.background = 'rgba(76,175,80,0.15)';  chip.style.color = '#81c784'; }
        el.appendChild(chip);
      }
    }
  }
});

// Highlight next upcoming card
const cards = [...document.querySelectorAll('#upcoming-cards .plan-card')];
if (cards.length) {
  cards[0].style.borderColor = '#4a5a7a';
  const pin = document.createElement('div');
  pin.style.cssText = 'position:absolute;top:12px;right:12px;background:rgba(255,255,255,0.08);color:#ce93d8;font-size:0.65rem;font-weight:700;padding:2px 8px;border-radius:8px;letter-spacing:0.5px;';
  pin.textContent = 'NEXT UP';
  cards[0].appendChild(pin);
}

// Init
updateCounts();
const archived = document.querySelectorAll('#archive-cards .plan-card').length;
document.getElementById('archive-count').textContent = archived;

// ‚îÄ‚îÄ‚îÄ YEAR RIBBON ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
(async function() {
  try {
    const res = await fetch('./trips-manifest.json?t=' + Date.now());
    const manifest = await res.json();
    renderRibbon(manifest.trips || []);
  } catch(e) { console.warn('Ribbon: failed to load manifest', e); }
})();

function renderRibbon(trips) {
  const today = new Date();
  today.setHours(0,0,0,0);
  const windowStart = new Date(today.getFullYear(), today.getMonth(), 1);
  const windowEnd   = new Date(windowStart.getFullYear() + 1, windowStart.getMonth(), windowStart.getDate());
  const totalMs = windowEnd - windowStart;
  const isMobile = () => window.innerWidth < 700;

  function pct(date) { return Math.max(0, Math.min(100, (date - windowStart) / totalMs * 100)); }
  function dateAtPct(p) { return new Date(windowStart.getTime() + p * totalMs); }

  // Today marker
  document.getElementById('ribbon-today').style.left = pct(today) + '%';

  // Month labels
  const monthsEl = document.getElementById('ribbon-months');
  const MONTHS_LONG  = ['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec'];
  const MONTHS_SHORT = ['J','F','M','A','M','J','J','A','S','O','N','D'];
  for (let i = 0; i < 12; i++) {
    const mo = new Date(windowStart.getFullYear(), windowStart.getMonth() + i, 1);
    const moEnd = new Date(mo.getFullYear(), mo.getMonth() + 1, 1);
    const w = (Math.min(moEnd, windowEnd) - mo) / totalMs * 100;
    const div = document.createElement('div');
    div.className = 'ribbon-month' + (mo.getMonth() === today.getMonth() && mo.getFullYear() === today.getFullYear() ? ' is-current' : '');
    div.style.width = w + '%';
    div.textContent = isMobile() ? MONTHS_SHORT[mo.getMonth()] : MONTHS_LONG[mo.getMonth()];
    monthsEl.appendChild(div);
  }

  // Build trip bar data
  const tripData = [];
  trips.forEach(trip => {
    if (!trip.startDate || !trip.endDate) return;
    const start = new Date(trip.startDate + 'T00:00:00');
    const end   = new Date(trip.endDate   + 'T00:00:00');
    if (end < windowStart || start > windowEnd) return;
    tripData.push({ trip, start, end,
      leftPct:  pct(start),
      rightPct: pct(end),
      isPast: end < today,
      daysAway: Math.ceil((start - today) / 86400000),
      tripDays: Math.round((end - start) / 86400000)
    });
  });

  // Render bars
  const barsEl = document.getElementById('ribbon-bars');
  const track  = document.getElementById('ribbon-track');
  const tip    = document.getElementById('ribbon-tip');

  tripData.forEach(td => {
    const width = Math.max(td.rightPct - td.leftPct, 1.2);
    const bar = document.createElement('div');
    bar.className = 'ribbon-bar' + (td.isPast ? ' past' : '');
    bar.style.left       = td.leftPct + '%';
    bar.style.width      = width + '%';
    bar.style.background = td.trip.color || '#9c27b0';
    bar.textContent      = width > 8 ? td.trip.emoji + ' ' + td.trip.title : td.trip.emoji;
    bar.dataset.tripId   = td.trip.id;
    barsEl.appendChild(bar);
  });

  // ‚îÄ‚îÄ SCRUB / DRAG ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  const MONTHS_FMT = ['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec'];
  let scrubbing = false;
  let tapTimer  = null;
  let lastHighlightId = null;

  tip.style.position = 'absolute';

  function tripAtPct(p) {
    return tripData.find(td => p >= td.leftPct && p <= td.rightPct) || null;
  }

  function formatDate(d) {
    return MONTHS_FMT[d.getMonth()] + ' ' + d.getDate();
  }

  function showScrubTip(clientX, clientY, p) {
    const date = dateAtPct(p / 100);
    const hit  = tripAtPct(p);

    if (hit) {
      const label = hit.daysAway > 0 ? `in ${hit.daysAway}d` : hit.isPast ? 'past' : 'now';
      tip.innerHTML = `<strong>${hit.trip.emoji} ${hit.trip.title}</strong><br>${hit.trip.dates} &nbsp;¬∑&nbsp; ${hit.tripDays}d &nbsp;¬∑&nbsp; <span style="color:#81c784">${label}</span>`;
      // Highlight active bar
      if (lastHighlightId !== hit.trip.id) {
        barsEl.querySelectorAll('.ribbon-bar').forEach(b => b.style.filter = '');
        barsEl.querySelector(\`[data-trip-id="\${hit.trip.id}"]\`).style.filter = 'brightness(1.35)';
        lastHighlightId = hit.trip.id;
      }
    } else {
      tip.innerHTML = `<span style="color:#7a8a9a">${formatDate(date)}</span>`;
      if (lastHighlightId) {
        barsEl.querySelectorAll('.ribbon-bar').forEach(b => b.style.filter = '');
        lastHighlightId = null;
      }
    }

    tip.style.display = 'block';
    const tipW = tip.offsetWidth;
    const trackRect = track.getBoundingClientRect();
    let left = clientX - trackRect.left - tipW / 2;
    left = Math.max(0, Math.min(left, trackRect.width - tipW));
    tip.style.left = left + 'px';
    tip.style.top  = '-44px';
  }

  function hideScrubTip() {
    tip.style.display = 'none';
    barsEl.querySelectorAll('.ribbon-bar').forEach(b => b.style.filter = '');
    lastHighlightId = null;
  }

  function clientXtoPct(clientX) {
    const rect = track.getBoundingClientRect();
    return Math.max(0, Math.min(100, (clientX - rect.left) / rect.width * 100));
  }

  // Touch events (mobile scrub)
  track.addEventListener('touchstart', e => {
    scrubbing = true;
    const t = e.touches[0];
    showScrubTip(t.clientX, t.clientY, clientXtoPct(t.clientX));
    e.preventDefault();
  }, { passive: false });

  track.addEventListener('touchmove', e => {
    if (!scrubbing) return;
    const t = e.touches[0];
    showScrubTip(t.clientX, t.clientY, clientXtoPct(t.clientX));
    e.preventDefault();
  }, { passive: false });

  track.addEventListener('touchend', e => {
    scrubbing = false;
    const t = e.changedTouches[0];
    const p = clientXtoPct(t.clientX);
    const hit = tripAtPct(p);
    // Short tap on a trip = navigate; otherwise just dismiss after delay
    if (hit) {
      setTimeout(() => navigateToTrip(hit.trip), 180);
    } else {
      setTimeout(hideScrubTip, 800);
    }
  });

  // Mouse events (desktop scrub / hover)
  track.addEventListener('mouseenter', e => {
    showScrubTip(e.clientX, e.clientY, clientXtoPct(e.clientX));
  });
  track.addEventListener('mousemove', e => {
    showScrubTip(e.clientX, e.clientY, clientXtoPct(e.clientX));
  });
  track.addEventListener('mouseleave', hideScrubTip);
  track.addEventListener('click', e => {
    const p = clientXtoPct(e.clientX);
    const hit = tripAtPct(p);
    if (hit) navigateToTrip(hit.trip);
  });
}

function navigateToTrip(trip) {
  const card = document.querySelector(\`.plan-card[data-href*="\${trip.id}"]\`) ||
               document.querySelector(\`.plan-card[data-href="\${trip.planPage}"]\`);
  if (card) card.scrollIntoView({ behavior: 'smooth', block: 'center' });
  else if (trip.planPage) location.href = trip.planPage;
}

</script>
</body>
</html>
